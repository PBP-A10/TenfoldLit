{% extends 'base.html' %}

{% block meta %}
<title>Detail Buku</title>
{% endblock meta %}

{% block content %}
    <h1>Detail Buku</h1>
    <h2>{{ book.title }}</h2>
    <p>{{ book.img }}</p>
    <p>Penulis: {{ book.author }}</p>
    <p>Format: {{ book.bookformat }}</p>
    <p>Deskripsi: {{ book.desc }}</p>
    <p>Genre: {{ book.genre }}</p>
    <p>ISBN: {{ book.isbn }}</p>
    <p>Halaman: {{ book.pages }}</p>
    <p>Rating: {{ review.rating }}</p>


    
    <h3>Ulasan Pengguna</h3>
    <ul id="reviews-list">
        {% for review in reviews %}
        <li>{{ review.user }}: {{ review.comment }}</li>
        {% endfor %}
    </ul>

    <h3>Beri Peringkat dan Ulasan Anda</h3>
    <form id="review-form">
        {% csrf_token %}
        <label for="rating">Rating:</label>
        <select id="rating" name="rating">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
        </select>
        <br>
        <label for="comment">Ulasan:</label>
        <textarea id="comment" name="comment" rows="4"></textarea>
        <br>
        <button type="submit">Submit</button>
    </form>
    <!--Borrow Modal-->
    <div class="modal fade" tabindex="-1" role="dialog" id="myModal{{ book.pk }}">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Borrow Book</h5>
              <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <!-- Your form goes here -->       
                <div class="form-group">
                <form id="form">
                        {% csrf_token %} 
                        <label for="date_ended">Pinjam sampai tanggal berapa sieh:</label>
                        <input type="date" onchange="changeValue();" class="form-control" id="date_ended" name="date_ended">
                </form>
                </div>
            </div>
            <div id="${book.pk}" class="modal-footer id-parent">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="submit" onclick="borrowBook('{{ book.pk }}');" class="btn btn-primary borrow" id="borrow-button" data-bs-dismiss="modal">Submit</button>
            </div>
          </div>
        </div>
        </div>
    </div>
    <!--End Borrow Modal-->

    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#myModal{{ book.pk }}">Borrow Book</button>
</body>

<!-- Modal -->
<div class="modal fade" id="successModal" tabindex="-1" role="dialog" aria-labelledby="successModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="successModalLabel">Success</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          Book borrowing was successful!
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>
<!--End of Modal-->

<!-- Error Modal -->
<div class="modal fade" id="errorModal" tabindex="-1" role="dialog" aria-labelledby="errorModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="errorModalLabel">Error</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            Unsuccessful. The book has been borrowed.
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>
<!--End of Modal-->
<script>
function borrowBook(itemId) {
        const date =  document.getElementById("date_ended")
        console.log(date.value)
        fetch("/myLibrary/borrow-books/" + itemId, {
        method: 'POST',
        body: new FormData(document.querySelector('#form'))
        })
        .then(response => {
        if (response.status === 201) {
            $('#successModal').modal('show');
        } else {
            $('#errorModal').modal('show');
        }
        });
}


function changeValue(){
        const dateInput = document.getElementById("date_ended");
        console.log(dateInput.value)
}

</script>
{% endblock content %}
