{% extends 'base.html' %}

{% block meta %}

{% endblock meta %}

{% block content %}

<h1>Katalog Buku</h1>
<ul>
        {% for book in books %}
        <li>
        <a href="{% url 'catalog:book_reviews' book.id %}">{{ book.title }}</a>
        <p>Rating: {{ review.rating }}</p>
        <button class="favorite-button" data-bookid="{{ book.id }}">Tambah ke Favorit</button>
        </li>
        {% endfor %}
</ul>

<!-- Modal -->
<div class="modal fade" id="successModal" tabindex="-1" role="dialog" aria-labelledby="successModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="successModalLabel">Success</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              Book borrowing was successful!
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
<!--End of Modal-->

<!-- Error Modal -->
<div class="modal fade" id="errorModal" tabindex="-1" role="dialog" aria-labelledby="errorModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="errorModalLabel">Error</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
                Unsuccessful. The book has been borrowed.
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
<!--End of Modal-->

<script>
// Menggunakan jQuery untuk menangani permintaan AJAX
$(document).ready(function() {
        $(".favorite-button").click(function() {
        var bookId = $(this).data("bookid");
        var button = $(this);
        var url = "{% url 'catalog:mark_as_favorite' 0 %}".replace('0', bookId);

        // Kirim permintaan AJAX untuk menambah atau menghapus dari favorit
        $.ajax({
                url: url,
                method: "POST",
                data: { 'csrfmiddlewaretoken': "{{ csrf_token }}" },
                success: function(data) {
                // Periksa respons dari server
                if (data.is_favorite) {
                        button.text("Unfavorite");
                } else {
                        button.text("Tambah ke Favorit");
                }
                },
                error: function(error) {
                console.log("Gagal mengirim permintaan.");
                }
        });
        });
});
   
</script>

{% endblock content %}

